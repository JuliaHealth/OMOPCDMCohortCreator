<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Using OMOPCDMCohortCreator with R 🏴‍☠️ · OMOPCDMCohortCreator.jl</title><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://JuliaHealth.github.io/OMOPCDMCohortCreator.jl/tutorials/r_tutorial/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">OMOPCDMCohortCreator.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../">Tutorials</a></li><li><a class="tocitem" href="../beginner_tutorial/">Beginner Tutorial 🐣</a></li><li class="is-active"><a class="tocitem" href>Using OMOPCDMCohortCreator with R 🏴‍☠️</a><ul class="internal"><li><a class="tocitem" href="#Analysis-Set-up"><span>Analysis Set-up 📝</span></a></li><li><a class="tocitem" href="#Create-Database-Connection-to-Eunomia"><span>Create Database Connection to Eunomia 💾</span></a></li><li><a class="tocitem" href="#Characterization-Analysis"><span>Characterization Analysis 🤒</span></a></li><li><a class="tocitem" href="#Conclusion"><span>Conclusion 🎉</span></a></li><li><a class="tocitem" href="#Appendix"><span>Appendix 🕵️</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../api/">API</a></li><li><a class="tocitem" href="../../contributing/">Contributing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Using OMOPCDMCohortCreator with R 🏴‍☠️</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Using OMOPCDMCohortCreator with R 🏴‍☠️</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaHealth/OMOPCDMCohortCreator.jl/blob/dev/docs/src/tutorials/r_tutorial.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Using-OMOPCDMCohortCreator-with-R"><a class="docs-heading-anchor" href="#Using-OMOPCDMCohortCreator-with-R">Using OMOPCDMCohortCreator with R 🏴‍☠️</a><a id="Using-OMOPCDMCohortCreator-with-R-1"></a><a class="docs-heading-anchor-permalink" href="#Using-OMOPCDMCohortCreator-with-R" title="Permalink"></a></h1><ul><li><a href="#Using-OMOPCDMCohortCreator-with-R">Using OMOPCDMCohortCreator with R 🏴‍☠️</a></li><li class="no-marker"><ul><li><a href="#Analysis-Set-up">Analysis Set-up 📝</a></li><li><a href="#Create-Database-Connection-to-Eunomia">Create Database Connection to Eunomia 💾</a></li><li><a href="#Characterization-Analysis">Characterization Analysis 🤒</a></li><li><a href="#Conclusion">Conclusion 🎉</a></li><li><a href="#Appendix">Appendix 🕵️</a></li></ul></li></ul><p>This tutorial builds on the <a href="tutorials/tutorials/beginner_tutorial.md">Beginner Tutorial</a> in creating a characterization study but instead of using Julia, we will use R! This assumes the user has familiarity with R but familiarity with Julia is not required. By the end of this tutorial, you will learn how to use OMOPCDMCohortCreator directly within R without having to ever touch Julia.</p><h2 id="Analysis-Set-up"><a class="docs-heading-anchor" href="#Analysis-Set-up">Analysis Set-up 📝</a><a id="Analysis-Set-up-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis-Set-up" title="Permalink"></a></h2><h3 id="R-and-Julia-Installation"><a class="docs-heading-anchor" href="#R-and-Julia-Installation">R and Julia Installation</a><a id="R-and-Julia-Installation-1"></a><a class="docs-heading-anchor-permalink" href="#R-and-Julia-Installation" title="Permalink"></a></h3><p>You will need to have R and Julia installed onto your computer. Here are the minimum required versions needed:</p><ul><li>R version must be greater than or equal to version <span>$3.2$</span>.</li><li>Julia version must be greater than or equal to version <span>$1.7$</span>.</li></ul><p>Furthermore, the Julia executable must be available from the system <code>PATH</code> or you can set the <code>JULIA_BINDIR</code> R environment variable to where the Julia <code>bin</code> directory is on your computer like this:</p><pre><code class="language-r hljs"># For Windows
Sys.setenv(JULIA_BINDIR = &quot;C:/Users/user/AppData/Local/Programs/Julia-1.7.1/bin&quot;)

# For Linux or OSX
Sys.setenv(JULIA_BINDIR = &quot;~/path/to/Julia-1.7.1/bin&quot;)</code></pre><h3 id="Packages"><a class="docs-heading-anchor" href="#Packages">Packages</a><a id="Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Packages" title="Permalink"></a></h3><h4 id="R-Packages"><a class="docs-heading-anchor" href="#R-Packages">R Packages</a><a id="R-Packages-1"></a><a class="docs-heading-anchor-permalink" href="#R-Packages" title="Permalink"></a></h4><p>You will need the following packages for this tutorial which you can install with <code>install.packages</code>:</p><ul><li><code>dplyr</code></li><li><code>JuliaConnectoR</code></li><li><code>tibble</code></li></ul><p>To read more on these packages and what they do, see the <a href="#appendix">appendix</a> for details.</p><h4 id="Julia-Packages"><a class="docs-heading-anchor" href="#Julia-Packages">Julia Packages</a><a id="Julia-Packages-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-Packages" title="Permalink"></a></h4><p>You will need the following packages for this tutorial:</p><ul><li><code>HealthSampleData</code></li><li><code>OMOPCDMCohortCreator</code></li><li><code>SQLite</code></li></ul><p>We will have to install them as follows from within R:</p><pre><code class="language-r hljs">library(JuliaConnectoR)

pkg &lt;- juliaImport(&quot;Pkg&quot;)

pkg$activate(&quot;TUTORIAL&quot;, shared = TRUE) 
# NOTE: You could specify the path to where your project is or any other path you want; set `shared` to `FALSE` if you do

pkg$add(c(&quot;HealthSampleData&quot;, &quot;OMOPCDMCohortCreator&quot;, &quot;SQLite&quot;))</code></pre><p>To read more on these packages and what they do, see the <a href="#appendix">appendix</a> for details.</p><h4 id="Activating-Analysis-Environment"><a class="docs-heading-anchor" href="#Activating-Analysis-Environment">Activating Analysis Environment</a><a id="Activating-Analysis-Environment-1"></a><a class="docs-heading-anchor-permalink" href="#Activating-Analysis-Environment" title="Permalink"></a></h4><p>Now within R, anytime you want to use these installed packages, do the following:</p><pre><code class="language-r hljs">library(JuliaConnectoR)

pkg &lt;- juliaImport(&quot;Pkg&quot;)
pkg$activate(&quot;TUTORIAL&quot;, shared = TRUE) </code></pre><h3 id="Data"><a class="docs-heading-anchor" href="#Data">Data</a><a id="Data-1"></a><a class="docs-heading-anchor-permalink" href="#Data" title="Permalink"></a></h3><p>For this tutorial, we will work with data from <a href="https://github.com/OHDSI/Eunomia">Eunomia</a> that is stored in a SQLite format.</p><pre><code class="language-r hljs">hsd &lt;- juliaImport(&quot;HealthSampleData&quot;)

eunomia &lt;- hsd$Eunomia()</code></pre><blockquote><p><strong>NOTE:</strong> An internet connection will be needed to download this data. After this data is downloaded, internet is no longer required for this tutorial.</p></blockquote><h2 id="Create-Database-Connection-to-Eunomia"><a class="docs-heading-anchor" href="#Create-Database-Connection-to-Eunomia">Create Database Connection to Eunomia 💾</a><a id="Create-Database-Connection-to-Eunomia-1"></a><a class="docs-heading-anchor-permalink" href="#Create-Database-Connection-to-Eunomia" title="Permalink"></a></h2><p>After you have finished your set up in R, we need to establish a connection to the Eunomia SQLite database that we will use for the rest of the tutorial: </p><pre><code class="language-r hljs">slt &lt;- juliaImport(&quot;SQLite&quot;)

conn &lt;- slt$DB(eunomia)</code></pre><p>With Eunomia, the database&#39;s schema is simply called &quot;main&quot;. We will use this to generate database connection details that <code>OMOPCDMCohortCreator</code> will use internally. For this step, we will use <code>OMOPCDMCohortCreator</code>:</p><pre><code class="language-r hljs">occ &lt;- juliaImport(&quot;OMOPCDMCohortCreator&quot;)

occ$GenerateDatabaseDetails(juliaEval(&quot;:sqlite&quot;), &quot;main&quot;)</code></pre><p>Finally, we will generate internal representations of each table found within Eunomia for OMOPCDMCohortCreator to use:</p><pre><code class="language-r hljs">occ$GenerateTables(conn)</code></pre><p>As a check to make sure everything was correctly installed and works properly, the following block should work and return a list of all person ids in this data:</p><pre><code class="language-r hljs">occ$GetDatabasePersonIDs(conn) </code></pre><h2 id="Characterization-Analysis"><a class="docs-heading-anchor" href="#Characterization-Analysis">Characterization Analysis 🤒</a><a id="Characterization-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Characterization-Analysis" title="Permalink"></a></h2><h3 id="Background-for-Analysis"><a class="docs-heading-anchor" href="#Background-for-Analysis">Background for Analysis</a><a id="Background-for-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Background-for-Analysis" title="Permalink"></a></h3><p>As all the tools are working properly, let&#39;s do what is called a characterization study - a study that <em>characterizes</em> a group of patients with a certain condition (or conditions) across various attributes like race, age, and combinations thereof. We are going to do miniature version of such a study looking at patients with <em>strep throat</em>. For this, we will use the <code>condition_concept_id</code>, <span>$28060$</span>.</p><h3 id="Task:-Find-All-Patients-with-Strep-Throat"><a class="docs-heading-anchor" href="#Task:-Find-All-Patients-with-Strep-Throat">Task: Find All Patients with Strep Throat</a><a id="Task:-Find-All-Patients-with-Strep-Throat-1"></a><a class="docs-heading-anchor-permalink" href="#Task:-Find-All-Patients-with-Strep-Throat" title="Permalink"></a></h3><pre><code class="language-r hljs">strep_patients &lt;- occ$ConditionFilterPersonIDs(28060, conn)
strep_patients &lt;- strep_patients$person_id</code></pre><h3 id="Task:-Find-the-Race-of-Patients-with-Strep-Throat"><a class="docs-heading-anchor" href="#Task:-Find-the-Race-of-Patients-with-Strep-Throat">Task: Find the Race of Patients with Strep Throat</a><a id="Task:-Find-the-Race-of-Patients-with-Strep-Throat-1"></a><a class="docs-heading-anchor-permalink" href="#Task:-Find-the-Race-of-Patients-with-Strep-Throat" title="Permalink"></a></h3><pre><code class="language-r hljs">strep_patients_race &lt;- occ$GetPatientRace(strep_patients, conn)</code></pre><h3 id="Task:-Find-the-Gender-of-Patients-with-Strep-Throat"><a class="docs-heading-anchor" href="#Task:-Find-the-Gender-of-Patients-with-Strep-Throat">Task: Find the Gender of Patients with Strep Throat</a><a id="Task:-Find-the-Gender-of-Patients-with-Strep-Throat-1"></a><a class="docs-heading-anchor-permalink" href="#Task:-Find-the-Gender-of-Patients-with-Strep-Throat" title="Permalink"></a></h3><pre><code class="language-r hljs">strep_patients_gender &lt;- occ$GetPatientGender(strep_patients, conn)</code></pre><h3 id="Task:-Create-Age-Groupings-of-Patients-with-Strep-Throat"><a class="docs-heading-anchor" href="#Task:-Create-Age-Groupings-of-Patients-with-Strep-Throat">Task: Create Age Groupings of Patients with Strep Throat</a><a id="Task:-Create-Age-Groupings-of-Patients-with-Strep-Throat-1"></a><a class="docs-heading-anchor-permalink" href="#Task:-Create-Age-Groupings-of-Patients-with-Strep-Throat" title="Permalink"></a></h3><p>For this task, for every single person who has a strep throat diagnosis, we need to assign them an age group. For this demo, age groupings will be made along <span>$5$</span> year intervals when assigned to a person up to <span>$100$</span> years of age (e.g. <span>$[0, 4], [5, 9], ... [95, 100]$</span>).</p><pre><code class="language-r hljs">age_groups &lt;- list(
	list(0, 4),
	list(5, 9),
	list(10, 14),
	list(15, 19),
	list(20, 24),
	list(25, 29),
	list(30, 34),
	list(35, 39),
	list(40, 44),
	list(45, 49),
	list(50, 54),
	list(55, 59),
	list(60, 64),
	list(65, 69),
	list(70, 74),
	list(75, 79),
	list(80, 84),
	list(85, 89),
	list(90, 94),
	list(95, 99))

strep_patients_age_group &lt;- occ$GetPatientAgeGroup(strep_patients, conn, age_groupings = age_groups)</code></pre><h3 id="Task:-Characterize-Each-Person-by-Gender,-Race,-and-Age-Group"><a class="docs-heading-anchor" href="#Task:-Characterize-Each-Person-by-Gender,-Race,-and-Age-Group">Task: Characterize Each Person by Gender, Race, and Age Group</a><a id="Task:-Characterize-Each-Person-by-Gender,-Race,-and-Age-Group-1"></a><a class="docs-heading-anchor-permalink" href="#Task:-Characterize-Each-Person-by-Gender,-Race,-and-Age-Group" title="Permalink"></a></h3><p>With the previous tasks, we now know patients&#39; gender, race, and age group. Using this information, we can combine these features to create a final table showing each patient&#39;s <code>person_id</code>, gender, race, and age group per row. To do this combining, we will use the <code>dplyr</code> and <code>tibble</code> packages:</p><pre><code class="language-r hljs">library(dplyr)
library(tibble)

strep_patients &lt;- tibble(data.frame(person_id=strep_patients))
strep_patients_race &lt;- tibble(data.frame(strep_patients_race))
strep_patients_gender &lt;- tibble(data.frame(strep_patients_gender))
strep_patients_age_group &lt;- tibble(data.frame(strep_patients_age_group))</code></pre><h3 id="Task:-Create-Patient-Groupings"><a class="docs-heading-anchor" href="#Task:-Create-Patient-Groupings">Task: Create Patient Groupings</a><a id="Task:-Create-Patient-Groupings-1"></a><a class="docs-heading-anchor-permalink" href="#Task:-Create-Patient-Groupings" title="Permalink"></a></h3><p>Often with characterization style studies, it is extremely important to aggregate patient populations. This is to protect the anonymity of patients with perhaps severely sensitive conditions (e.g. mental illnesses, sexually transmitted diseases, etc.) from possible repercussions from accidental disclosure of this patient information.</p><pre><code class="language-r hljs">final_df &lt;- full_join(strep_patients, strep_patients_race, by = c(&quot;person_id&quot; = &quot;person_id&quot;)) %&gt;% 
full_join(strep_patients_age_group, by = c(&quot;person_id&quot; = &quot;person_id&quot;)) %&gt;%
full_join(strep_patients_gender, by = c(&quot;person_id&quot; = &quot;person_id&quot;)) %&gt;%
select(-person_id) %&gt;% 
count(race_concept_id, age_group, gender_concept_id) %&gt;%
rename(count = &quot;n&quot;) %&gt;%
filter(count &gt; 10)</code></pre><h2 id="Conclusion"><a class="docs-heading-anchor" href="#Conclusion">Conclusion 🎉</a><a id="Conclusion-1"></a><a class="docs-heading-anchor-permalink" href="#Conclusion" title="Permalink"></a></h2><p>This mini characterization study that we just conducted on this dataset opens up a whole new avenue for a researcher to pursue. For example, we could now calculate prevalence rates across different patient characteristics or compare and contrast multiple conditions at once. It should also be apparent that the API is set up in a very particular way: it is functional meaning that each function does one thing only. This gives a lot of flexibility to a user to build together a study incrementally using <code>OMOPCDMCohortCreator</code>.</p><h2 id="Appendix"><a class="docs-heading-anchor" href="#Appendix">Appendix 🕵️</a><a id="Appendix-1"></a><a class="docs-heading-anchor-permalink" href="#Appendix" title="Permalink"></a></h2><h3 id="Packages-Used-in-Analysis"><a class="docs-heading-anchor" href="#Packages-Used-in-Analysis">Packages Used in Analysis</a><a id="Packages-Used-in-Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Packages-Used-in-Analysis" title="Permalink"></a></h3><h4 id="R-Packages-Used:"><a class="docs-heading-anchor" href="#R-Packages-Used:">R Packages Used:</a><a id="R-Packages-Used:-1"></a><a class="docs-heading-anchor-permalink" href="#R-Packages-Used:" title="Permalink"></a></h4><ul><li><a href="https://dplyr.tidyverse.org"><code>dplyr</code></a> - grammar of data manipulation</li><li><a href="https://tibble.tidyverse.org"><code>tibble</code></a> - modern reimagining of the data.frame</li><li><a href="https://github.com/stefan-m-lenz/JuliaConnectoR"><code>JuliaConnectoR</code></a> - a functionally oriented interface for calling Julia from R</li></ul><h4 id="Julia-Packages-Used:"><a class="docs-heading-anchor" href="#Julia-Packages-Used:">Julia Packages Used:</a><a id="Julia-Packages-Used:-1"></a><a class="docs-heading-anchor-permalink" href="#Julia-Packages-Used:" title="Permalink"></a></h4><ul><li><a href="https://github.com/JuliaHealth/OMOPCDMCohortCreator.jl"><code>OMOPCDMCohortCreator</code></a> - Create cohorts from databases utilizing the OMOP CDM</li><li><a href="https://github.com/JuliaHealth/HealthSampleData.jl"><code>HealthSampleData</code></a> - Sample health data for a variety of health formats and use cases</li><li><a href="https://github.com/JuliaDatabases/SQLite.jl"><code>SQLite</code></a> - A Julia interface to the SQLite library</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../beginner_tutorial/">« Beginner Tutorial 🐣</a><a class="docs-footer-nextpage" href="../../api/">API »</a><div class="flexbox-break"></div><p class="footer-message">Created by <a href="https://jacobzelko.com">Jacob Zelko</a> &amp; <a href="https://www.gtri.gatech.edu">Georgia Tech Research Institute</a>. <a href="https://github.com/JuliaHealth/OMOPCDMCohortCreator.jl/blob/main/LICENSE">License</a></p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Tuesday 16 January 2024 18:45">Tuesday 16 January 2024</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
